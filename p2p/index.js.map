{"version":3,"sources":["../../src/p2p/index.js"],"names":["p2p","Server","port","initConnection","ws","update","connectToPeers","newPeers","forEach","peer","on","console","log"],"mappings":";;;;;;;AAAA;;;;AAEA;;;;AACA;;;;AACA;;AACA;;;;AAEA,MAAMA,MAAM,IAAI,aAAUC,MAAd,CAAqB;AAC7BC,UAAM,gBAAOF,GAAP,CAAWE;AADY,CAArB,CAAZ;;AAIO,MAAMC,0CAAkBC,EAAD,IAAQ;AAClC,sBAAQC,MAAR,CAAeD,EAAf;AACA,6BAAUA,EAAV;AACA,2BAAQA,EAAR;AACA,yBAAMA,EAAN,EAAU,mCAAV;AACH,CALM;;AAOA,MAAME,0CAAkBC,QAAD,IAAc;AACxCA,aAASC,OAAT,CAAkBC,IAAD,IAAU;AACvB,cAAML,KAAK,iBAAcK,IAAd,CAAX;AACAL,WAAGM,EAAH,CAAM,MAAN,EAAc,MAAM;AAChBC,oBAAQC,GAAR,CAAY,+BAAZ,EAA6CH,IAA7C;AACAN,2BAAeC,EAAf;AACH,SAHD;AAIAA,WAAGM,EAAH,CAAM,OAAN,EAAe,MAAM;AACjBC,oBAAQC,GAAR,CAAY,6BAAZ,EAA2CH,IAA3C;AACH,SAFD;AAGH,KATD;AAUH,CAXM;;kBAaQT,G","file":"index.js","sourcesContent":["import WebSocket from 'ws';\n\nimport config from '../config/index';\nimport sockets from './sockets';\nimport { onMessage, onError, write } from './handlers';\nimport { queryChainLengthMsg } from './actions';\n\nconst p2p = new WebSocket.Server({\n    port: config.p2p.port\n});\n\nexport const initConnection = (ws) => {\n    sockets.update(ws);\n    onMessage(ws);\n    onError(ws);\n    write(ws, queryChainLengthMsg());\n};\n\nexport const connectToPeers = (newPeers) => {\n    newPeers.forEach((peer) => {\n        const ws = new WebSocket(peer);\n        ws.on('open', () => {\n            console.log('Connection received to peer: ', peer);\n            initConnection(ws);\n        });\n        ws.on('error', () => {\n            console.log('Connection failed to peer: ', peer);\n        });\n    });\n};\n\nexport default p2p;"]}